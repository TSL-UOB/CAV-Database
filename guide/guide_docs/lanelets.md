# Adding Lanelets

A manual process to add lanelets to the database. First remove any existing table if you need to or if you are getting errors with primary key duplicates.

``` sql
DROP TABLE IF EXISTS  sim_log.lanelets
```

Then create the table including an id and the geom colum for the polygon data.

``` sql
create table sim_log.lanelets (lanelet_id int, geom geometry(polygon, 4326), PRIMARY KEY(lanelet_id));
```

This example we will use the T_Junction_lanelets_bounds.txt file in the matlab folder to generate the lanelet data. Use the plot_laneletes.m matlab code to generate the SQL_query in the final code block.

``` matlab
unique_IDs = unique(lanelet.lanelet_id);

for id_index = 1: numel(unique_IDs)
    
    laneletID = unique_IDs(id_index);
    sel = lanelet(laneletID==lanelet.lanelet_id,:);
    left_x = sel.x(sel.bound=='leftBound',:);
    left_y = sel.y(sel.bound=='leftBound',:);
    righ_x = sel.x(sel.bound=='rightBound',:);
    righ_y = sel.y(sel.bound=='rightBound',:);
    run('plot_func');

    % Coordinates for easy debugging
    coords = [left_x, left_y;flip(righ_x), flip(righ_y); left_x(1), left_y(1)];

    lat_long_convert %get the conversion ratios
    GPS = zeros(numel(coords(:,1)),2);
    GPS_str = '';
    %assuming XY data is in meters
    for index=1:numel(coords(:,1))
        x = coords(index,1);
        y = coords(index,2);
        GPS(index,1) = x/m_per_deg_lon + minlon;
        GPS(index,2) = y/m_per_deg_lat + minlat;
        if index < numel(coords(:,1))
            GPS_str = strcat(GPS_str,sprintf(' %15.12f %15.12f,',GPS(index,1),GPS(index,2)));
        else
            GPS_str = strcat(GPS_str,sprintf(' %15.12f %15.12f' ,GPS(index,1),GPS(index,2)));
        end
    end
    
    SRID = 4326;
    h1 = "insert into sim_log.lanelets (lanelet_id, geom) VALUES ("
    
    lane_id = sprintf("%d, ",laneletID);
    top = "ST_GeomFromText('POLYGON((";
    tail = sprintf("))', %4.0f)",SRID);
    SQL_query = strcat(h1, lane_id, top, GPS_str, tail,")")
    print("pause to copy data...")

end
```

This should output a string that looks like this.

``` sql
insert into sim_log.lanelets (lanelet_id, geom) VALUES ( 100, ST_GeomFromText('POLYGON(( -2.516768552178 51.484952663441, -2.516763527209 51.484949361248, -2.516758502097 51.484946059056, -2.516753477128 51.484942756773, -2.516748478274 51.484939439391, -2.516743632351 51.484936035094, -2.516738960136 51.484932537862, -2.516734466245 51.484928951109, -2.516730155296 51.484925278251, -2.516726031327 51.484921522973, -2.516722098379 51.484917688960, -2.516718360492 51.484913779988, -2.516714821127 51.484909799920, -2.516711483893 51.484905752621, -2.516708352106 51.484901642138, -2.516705428798 51.484897472513, -2.516702716853 51.484893247791, -2.516700219012 51.484888972198, -2.516697937441 51.484884649867, -2.516695838666 51.484880291583, -2.516693738449 51.484875933570, -2.516691599133 51.484871582927, -2.516689420430 51.484867239923, -2.516687202773 51.484862904470, -2.516684946017 51.484858576925, -2.516682650162 51.484854257381, -2.516680315497 51.484849945925, -2.516677942022 51.484845642648, -2.516675529737 51.484841347820, -2.516673078787 51.484837061441, -2.516670589170 51.484832783781, -2.516668061032 51.484828514838, -2.516665494372 51.484824254794, -2.516662889480 51.484820003828, -2.516660256597 51.484815759602, -2.516657614049 51.484811517624, -2.516654962411 51.484807277893, -2.516652301540 51.484803040318, -2.516649631579 51.484798805081, -2.516646952384 51.484794572091, -2.516644263956 51.484790341257, -2.516641566439 51.484786112761, -2.516638859687 51.484781886601, -2.516636143847 51.484777662599, -2.516633418917 51.484773440934, -2.516630684754 51.484769221605, -2.516627941501 51.484765004523, -2.516625189015 51.484760789779, -2.516622429314 51.484756576832, -2.516619668749 51.484752364244, -2.516616885243 51.484748157409, -2.516614065669 51.484743959921, -2.516611210025 51.484739771871, -2.516608318313 51.484735593527, -2.516605390965 51.484731424801, -2.516602427692 51.484727265872, -2.516599428783 51.484723116919, -2.516596394238 51.484718978033, -2.516593324058 51.484714849304, -2.516590218673 51.484710730911, -2.516587077798 51.484706622854, -2.516583901574 51.484702525402, -2.516580690436 51.484698438647, -2.516577443951 51.484694362587, -2.516574162695 51.484690297403, -2.516570846525 51.484686243274, -2.516567495440 51.484682200200, -2.516564125599 51.484678163238, -2.516560755758 51.484674126276, -2.516557385917 51.484670089314, -2.516554016076 51.484666052352, -2.516550646091 51.484662015390, -2.516547276250 51.484657978428, -2.516543906409 51.484653941466, -2.516540536568 51.484649904504, -2.516585337259 51.484635390585, -2.516588707100 51.484639427547, -2.516592076941 51.484643464509, -2.516595446782 51.484647501471, -2.516598816767 51.484651538433, -2.516602186608 51.484655575395, -2.516605556449 51.484659612357, -2.516608926290 51.484663649319, -2.516612301469 51.484667692662, -2.516615776486 51.484671885387, -2.516619215435 51.484676089615, -2.516622618315 51.484680305259, -2.516625984838 51.484684532137, -2.516629314859 51.484688770161, -2.516632608522 51.484693019330, -2.516635865684 51.484697279374, -2.516639086200 51.484701550204, -2.516642269781 51.484705831729, -2.516645416717 51.484710123861, -2.516648526573 51.484714426329, -2.516651599495 51.484718739222, -2.516654635339 51.484723062183, -2.516657633959 51.484727395299, -2.516660595356 51.484731738303, -2.516663519242 51.484736091103, -2.516666405760 51.484740453611, -2.516669180898 51.484744688309, -2.516671949976 51.484748915547, -2.516674728143 51.484753169659, -2.516677496933 51.484757426018, -2.516680256633 51.484761684804, -2.516683007099 51.484765945837, -2.516685748188 51.484770209207, -2.516688480187 51.484774474914, -2.516691202953 51.484778742867, -2.516693916341 51.484783013068, -2.516696620495 51.484787285606, -2.516699315415 51.484791560390, -2.516702001102 51.484795837422, -2.516704677556 51.484800116790, -2.516707344775 51.484804398316, -2.516710014447 51.484808701862, -2.516712720477 51.484813117938, -2.516715386831 51.484817543451, -2.516718013077 51.484821978133, -2.516720599358 51.484826421982, -2.516723145530 51.484830874818, -2.516725651450 51.484835336464, -2.516728117261 51.484839806827, -2.516730542531 51.484844285729, -2.516732927548 51.484848773080, -2.516735271879 51.484853268610, -2.516737575813 51.484857772409, -2.516739838917 51.484862284117, -2.516742061480 51.484866803735, -2.516744243213 51.484871330993, -2.516746148658 51.484875293265, -2.516747935221 51.484878678237, -2.516749891451 51.484882026628, -2.516752015330 51.484885335112, -2.516754304548 51.484888600454, -2.516756757230 51.484891819508, -2.516759370635 51.484894989037, -2.516762142454 51.484898105987, -2.516765069658 51.484901167211, -2.516768149650 51.484904169654, -2.516771379255 51.484907110529, -2.516774755444 51.484909986870, -2.516778274610 51.484912795801, -2.516781933579 51.484915534626, -2.516785728599 51.484918200558, -2.516790123661 51.484921114199, -2.516795148774 51.484924416392, -2.516800173742 51.484927718584, -2.516805198711 51.484931020867, -2.516768552178 51.484952663441))', 4326))
```

This text can be dropped directly into and SQL query tool to add the data directly to the database. Now take a look at the lanelets table and view the geometry data, it should look like this.

![](../pics/lanelets_100.png)

Do this for each of the lanelet IDs, 100 to 117.